<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/layout/index :: dynamic(~{::main})}">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body class="container bg-body-secondary">
<main>
  <div class="container ">

    <div class="container mt-5">
      <div  class="row bg-white">
        <div class="col-5 ">
          <div th:if="${item.images != null and item.images.size() > 0}">
            <img id="mainImage" th:src="@{'/Image/imageUrl/' + ${item.images[0].imageUrl}}" class="card-img-top"/>
          </div>

          <div class="row mt-3">
            <div th:if="${item.images != null}" th:each="image : ${item.images}" class="col-2 border border-info p-1 mx-2 mb-2">
              <img th:src="@{'/Image/imageUrl/' + ${image.imageUrl}}" class="img-fluid"
                   onclick="changeMainImage(this.src)" />
            </div>
          </div>
          <div th:if="${item.images == null or item.images.size() == 0}">
            <p>Không có hình ảnh nào cho sản phẩm này.</p>
          </div>
        </div>
        <div class="col-7">
          <h4 class="mt-3">[[${item.name}]]</h4>
          <div class="row mt-5">
            <div class="col-4 text-secondary">
              <h5> Giá bán lẻ</h5>
            </div>
            <div class="col-7">
              <h5 th:text="${item.price}" class="text-danger">229.000 đ</h5>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-4 text-secondary">
              <h6>Tình trạng</h6>
            </div>
            <div class="col-7">
              <h6 th:text="${item.stockQuantity > 0 ? 'Còn Hàng' : 'Hết Hàng'}"></h6>
            </div>
          </div>
          <hr>
          <div class="row mt-2 my-auto">
            <div class="col-4">
              <h6 class="text-secondary">Vận chuyển</h6>
            </div>
            <div class="col-7">
              <h6>
                Miễn phí giao hàng cho đơn từ 300.000đ.
                Giao hàng trong 2 giờ.</h6>
            </div>
          </div>
          <hr>
          <div class="row mt-4">
            <div class="col-4">
              <h6 class="text-secondary">Loại</h6>
            </div>
            <div class="col-7">
              <h6>[[${item.unit}]]</h6>
            </div>
          </div>
          <div class="row my-3">
            <div class="col-4">
              <h6 class="text-secondary">Số Lượng Kho</h6>
            </div>
            <div class="col-7">
              <h6 class="stock-quantity" data-stock="[[${item.stockQuantity}]]">[[${item.stockQuantity}]]</h6>
            </div>
          </div>
          <div class="row my-3">
            <div class="col-4">
              <h6 class="text-secondary">Số Lượng Mua</h6>
            </div>
            <div class="col-7">
              <form id="addToCartForm-[[${p.productId}]]" class="addToCartForm">
                <input type="hidden" name="productId" th:value="${item.productId}" />
              <div class="col quantity-controls">
                <a href="#" class="text-decoration-none" onclick="updateQuantity(this, -1)">-</a>
                <input type="number" class="border px-2 quantity-input" name="quantity" value="1" min="1" onchange="updateQuantityInput(this)" />
                <a href="#" class="text-decoration-none" onclick="updateQuantity(this, 1)">+</a>
              </div>
            </div>
          </div>

            <!-- Giá trị quantity được truyền từ input điều chỉnh số lượng -->

            <button type="submit" class="btn btn-primary"
                    th:if="${item.stockQuantity > 0 and username != null}">
              Thêm vào giỏ hàng
            </button>
            <button type="button" class="btn btn-secondary"
                    th:if="${item.stockQuantity <= 0 and username != null}" disabled>
              Hết hàng
            </button>
            <button type="button" class="btn btn-secondary" th:if="${username == null}" disabled>Đăng nhập</button>
          </form>
          <div id="cartMessage"
               style="position: fixed; top: 70px; right: 5px; display: none; background-color: green; color: white; padding: 10px 15px; border: 2px solid white; border-radius: 5px; z-index: 9999; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
            Sản phẩm đã được thêm vào giỏ hàng!
          </div>
        </div>
      </div>
      <div class="row mt-5">
        <div class="col-5">
          <h3 class="mb-2">Mô Tả</h3>
        </div>
        <div class="col-7 ">
          <h3 class="mb-1">Thông Tin</h3>
        </div>
      </div>
      <div class="row bg-white">
        <div class="col-5">
          <h5 class="my-3" th:text="${item.description}"></h5>
          Bộ đôi nước súc miệng diệt khuẩn Listerine Cool Mint 750ml được sản xuất và đóng gói bởi thương hiệu Listerine – là một thương hiệu nước súc miệng sát trùng được hình thành từ năm 1914. Thương hiệu này giành được sự tán thưởng của hiệp hội nha khoa Mỹ cho sản phẩm chống vi trùng và bệnh viêm nướu răng. Với mục đích tiêu diệt vi khuẩn gây nên mảng bám răng, bệnh viêm lợi và hơi thở hôi, Listerine sử dụng hỗn hợp của 4 loại tinh dầu đặc biệt, tạo thành sản phẩm chăm sóc răng miệng dẫn đầu trong thị trường Úc và được người tiêu dùng trên khắp thế giới yêu thích.
          Bộ đôi nước súc miệng diệt khuẩn Listerine Cool Mint 750ml được sản xuất với thành phần đặc biệt có khả năng loại bỏ mảng bám, vi khuẩn trên răng, bảo vệ răng miệng suốt 12h với công thức không chứa cồn, không cay rát. Đồng thời, nước súc miệng có hương bạc hà tươi mát, giúp hơi thở thơm tho và mang lại cảm giác sảng khoái khi sử dụng.

          <h5>Hướng dẫn sử dụng và bảo quản</h5>
          Sau khi đánh răng, súc miệng trong vòng 30 giây rồi nhổ đi
          Không dùng cho trẻ em dưới 6 tuổi, không được nuốt
          Bảo quản nơi khô ráo, thoáng mát, tránh ánh nắng trực tiếp và nhiệt độ cao
          <h5>Lưu ý:</h5>

          <h6 class="text-danger">
            - Hạn sử dụng thực tế quý khách vui lòng xem trên bao bì.</h6>

          <h6 class="text-danger">
            - Hình sản phẩm chỉ mang tính chất minh họa, hình thực tế bao bì của sản phẩm tùy thời điểm sẽ khác so với thực tế.
          </h6>
        </div>
        <div class="col-7 ">
          <div class="row text-secondary my-3">
            <div class="col-3 ">
              <h6> Xuất Xứ </h6>
            </div>
            <div class="col-9">
              <h6>[[${item.origin}]]</h6>
            </div>
            <hr>
          </div>
          <div class="row text-secondary my-3">
            <div class="col-3">
              <h6>Thành Phần</h6>
            </div>
            <div class="col-9">
              <h6>
                Water, Glycerin, Propylene Glycol, Sorbitol, Tetrapotassium, Pyrophosphate, Polysorbate 20, Tetrasodium Pyrophosphate, Zinc Citrate...</h6>
            </div>
            <hr>
          </div>
          <div class="row text-secondary my-3">
            <div class="col-3 mb-2">
              <h6>Hướng Dẫn Sử Dụng </h6>
            </div>
            <div class="col-9">
              <h6>Sản Phẩm có hướng dẫn sử dụng trên bao bì</h6>
            </div>
            <hr>
          </div>
          <div class="row text-secondary mb-5">
            <div class="col-3 mb-2">
              <h6>Bảo Quản</h6>
            </div>
            <div class="col-9">
              <h6>Bảo quản nơi khô ráo thoáng mát, tránh ánh nắng trực tiếp</h6>
            </div>
            <hr>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Hàm cập nhật số lượng khi nhấp vào dấu + hoặc -
    function updateQuantity(link, change) {
      const inputField = link.closest('.quantity-controls').querySelector('.quantity-input');
      let currentQuantity = parseInt(inputField.value);
      const stockQuantity = parseInt(document.querySelector('.stock-quantity').innerText);  // Lấy số lượng kho từ DOM

      // Cập nhật số lượng và kiểm tra nếu số lượng nhỏ hơn 1 hoặc lớn hơn số lượng kho
      currentQuantity += change;
      if (currentQuantity < 1) {
        currentQuantity = 1;
      } else if (currentQuantity > stockQuantity) {
        currentQuantity = stockQuantity; // Đảm bảo số lượng mua không vượt quá số lượng kho
      }

      // Cập nhật giá trị input
      inputField.value = currentQuantity;

      // Hiển thị thông báo cho người dùng (có thể sử dụng thông báo nhỏ ở góc)
      showFeedback('Số lượng đã được cập nhật!');
    }

    // Hàm xử lý thay đổi số lượng khi người dùng nhập thủ công
    function updateQuantityInput(input) {
      let currentQuantity = parseInt(input.value);
      const stockQuantity = parseInt(document.querySelector('.stock-quantity').innerText);  // Lấy số lượng kho từ DOM

      // Kiểm tra nếu giá trị nhập không hợp lệ hoặc nhỏ hơn 1 hoặc lớn hơn số lượng kho
      if (isNaN(currentQuantity) || currentQuantity < 1) {
        currentQuantity = 1;
      } else if (currentQuantity > stockQuantity) {
        currentQuantity = stockQuantity; // Đảm bảo số lượng mua không vượt quá số lượng kho
      }

      input.value = currentQuantity;

      // Hiển thị thông báo cho người dùng
      showFeedback('Số lượng đã được cập nhật!');
    }

    // Hàm hiển thị phản hồi (thông báo) cho người dùng
    function showFeedback(message) {
      const feedback = document.createElement('div');
      feedback.classList.add('feedback-message');
      feedback.innerText = message;

      document.body.appendChild(feedback);

      // Sau 3 giây, ẩn thông báo
      setTimeout(() => {
        feedback.remove();
      }, 3000);
    }
  </script>
</main>
</body>
</html>