<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Danh sách đơn hàng</title>
</head>
<body>
<div class="main-wrapper" th:fragment="content">
    <div class="page-wrapper">
        <div class="content">
            <div class="page-header">
                <div class="page-title">
                    <h4>Danh sách đơn hàng</h4>
                    <h6>Quản lý các đơn hàng của bạn</h6>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <div class="table-top">
                        <div class="search-set">

                        </div>
                        <div class="wordset">
                            <ul>
                                <li>
                                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="pdf"><img
                                            src="/admin/img/icons/pdf.svg" alt="img"></a>
                                </li>
                                <li>
                                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="excel"><img
                                            src="/admin/img/icons/excel.svg" alt="img"></a>
                                </li>
                                <li>
                                    <a data-bs-toggle="tooltip" data-bs-placement="top" title="print"><img
                                            src="/admin/img/icons/printer.svg" alt="img"></a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="table-responsive">

                        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
                        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

                        <table class="table datanew">
                            <thead>
                            <tr>
                                <th>Tên sản phẩm</th>
                                <th>Tên người dùng</th>
                                <th>Ngày đặt hàng</th>
                                <th>Giá</th>
                                <th>Số điện thoại</th>
                                <th>Số lượng</th>
                                <th>Trạng thái</th>
                                <th>Phương thức thanh toán</th>
                                <th>Địa chỉ</th>
                                <th>Thao tác</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="order : ${orders}">
                                <td th:text="${order.orderDetails[0].product.name}">Tên sản phẩm</td>
                                <td th:text="${order.account.username}">Tên người dùng</td>
                                <td th:text="${#dates.format(order.orderDate, 'yyyy-MM-dd')}">Ngày đặt hàng</td>
                                <td th:text="${order.orderDetails[0].price}">Giá</td>
                                <td th:text="${order.account.phoneNumber}">Số điện thoại</td>
                                <td th:text="${order.orderDetails[0].quantity}">Số lượng</td>
                                <td>
                                    <form th:action="@{/Orders/{orderId}/change-payment-status(orderId=${order.orderId})}" method="post">
                                        <input type="hidden" name="page" th:value="${currentPage}" />
                                        <input type="hidden" name="size" th:value="${pageSize}" />
                                        <select name="paymentStatus" th:value="${order.paymentStatus != null ? order.paymentStatus : 'PENDING'}" onchange="this.form.submit()">
                                            <!-- Chờ xử lý (PENDING) -->
                                            <option value="PENDING" th:selected="${order.paymentStatus == 'PENDING'}"
                                                    th:disabled="${order.paymentStatus != 'PENDING'}">Chờ xử lý</option>

                                            <!-- Hoàn thành (COMPLETED) -->
                                            <option value="COMPLETED" th:selected="${order.paymentStatus == 'COMPLETED'}"
                                                    th:disabled="${order.paymentStatus != 'PENDING'}">Hoàn thành</option>

                                            <!-- Hủy bỏ (CANCELLED) -->
                                            <option value="CANCELLED" th:selected="${order.paymentStatus == 'CANCELLED'}"
                                                    th:disabled="${order.paymentStatus == 'CANCELLED'}">Hủy bỏ</option>
                                        </select>
                                    </form>
                                </td>
                                <td th:text="${order.paymentMethod}">Phương thức thanh toán</td>
                                <td th:text="${order.account.address}">Địa chỉ</td>
                                <td>
                                    <a th:href="@{/invoice/{orderId}(orderId=${order.orderId})}">
                                        <img src="/admin/img/icons/eye.svg" alt="img">
                                    </a>
                                    <!-- Hard Delete: Xóa hẳn đơn hàng khỏi cơ sở dữ liệu -->
                                    <form th:action="@{/Orders/{orderId}(orderId=${order.orderId})}" method="post" style="display:inline;">
                                        <input type="hidden" name="_method" value="delete" />
                                        <button type="submit" onclick="return confirm('Bạn có chắc chắn muốn xóa hẳn đơn hàng này?')">
                                            <img src="/admin/img/icons/delete.svg" alt="img" title="Xóa hẳn">
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination-wrapper text-center mt-2">
                        <!-- Nút Đầu Trang -->
                        <span th:if="${currentPage > 0}" class="pagination-button btn border-success">
                            <a th:href="@{/Orders/OrderList(page=0, size=${pageSize})}"><i class="bi bi-chevron-double-left"></i></a>
                        </span>

                        <!-- Nút Trước -->
                        <span th:if="${currentPage > 0}" class="pagination-button btn border-success">
                            <a th:href="@{/Orders/OrderList(page=${currentPage - 1}, size=${pageSize})}"><i class="bi bi-chevron-compact-left"></i></a>
                        </span>

                        <!-- Thông Tin Phân Trang -->
                        <span class="pagination-info btn btn-info text-light">
                            Trang <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span>
                        </span>

                        <!-- Nút Tiếp -->
                        <span th:if="${currentPage < totalPages - 1}" class="pagination-button btn border-success">
                            <a th:href="@{/Orders/OrderList(page=${currentPage + 1}, size=${pageSize})}"><i class="bi bi-chevron-compact-right"></i></a>
                        </span>

                        <!-- Nút Cuối Trang -->
                        <span th:if="${currentPage < totalPages - 1}" class="pagination-button btn border-success">
                            <a th:href="@{/Orders/OrderList(page=${totalPages - 1}, size=${pageSize})}"><i class="bi bi-chevron-double-right"></i></a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
