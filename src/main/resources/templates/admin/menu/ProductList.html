<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product List</title>
</head>
<body>
<div class="main-wrapper" th:fragment="content">
    <div class="page-wrapper">
        <div class="content">
            <div class="page-header d-flex justify-content-between align-items-center">
                <div class="page-title">
                    <h4>Product List</h4>
                </div>
                <div class="page-btn">
                    <a th:href="@{/Products/AddProduct}" class="btn btn-primary">Thêm sản phẩm mới</a>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <!-- Search and filter form -->
                    <div class="table-top mb-4">
                        <form th:action="@{/Products/ProductList}" method="get" class="d-flex align-items-center flex-wrap w-100" id="filter_form">
                            <input type="hidden" name="page" value="0">

                            <div class="d-flex w-100 flex-wrap justify-content-between align-items-center">
                                <!-- Filter Buttons -->
                                <div class="d-flex align-items-center mb-3 mb-md-0 w-25 justify-content-between">
                                    <button type="submit" class="btn btn-danger" name="filter" value="outOfStock"
                                            th:classappend="${filter == 'outOfStock'} ? 'active' : ''">
                                        Hết hàng
                                    </button>
                                    <button type="submit" class="btn btn-warning" name="filter" value="nearlyOutOfStock"
                                            th:classappend="${filter == 'nearlyOutOfStock'} ? 'active' : ''">
                                        Gần hết hàng
                                    </button>
                                    <button type="submit" class="btn btn-primary" name="filter" value=""
                                            th:classappend="${filter == null or filter == ''} ? 'active' : ''">
                                        Tất cả
                                    </button>
                                </div>

                                <!-- Category and Brand Filters -->
                                <div class="d-flex mt-4 mb-4 mb-md-0 w-50 gap-4">
                                    <!-- Category Filter -->
                                    <div class="form-group w-45">
                                        <select class="form-select" id="categoryFilter" name="cat">
                                            <option value="">-- Chọn danh mục --</option>
                                            <option th:each="category : ${categories}"
                                                    th:value="${category.categoryId}"
                                                    th:text="${category.categoryName}"
                                                    th:selected="${category.categoryId == cat}"></option>
                                        </select>
                                    </div>

                                    <!-- Brand Filter -->
                                    <div class="form-group w-45">
                                        <select class="form-select" id="brandFilter" name="brand">
                                            <option value="">-- Chọn thương hiệu --</option>
                                            <option th:each="brand : ${brands}"
                                                    th:value="${brand.brandId}"
                                                    th:text="${brand.brandName}"
                                                    th:selected="${brand.brandId == brand}"></option>
                                        </select>
                                    </div>

                                </div>

                                <!-- Submit Search -->
                                <div class="d-flex justify-content-center align-items-center w-25">
                                    <input type="search" name="search" class="form-control me-2" placeholder="Tìm kiếm">
                                    <button type="submit" class="btn btn-primary d-flex align-items-center">
                                        <img src="/admin/img/icons/search-whites.svg" alt="img" class="ms-2" style="width: 20px;">
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Product Table -->
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>Hình ảnh</th>
                                <th>Tên sản phẩm</th>
                                <th>Danh mục</th>
                                <th>Thương hiệu</th>
                                <th>Tên kho</th>
                                <th>Mô tả</th>
                                <th>Giá</th>
                                <th>Giảm giá</th>
                                <th>Số lượng</th>
                                <th>Đơn vị</th>
                                <th>Xuất xứ</th>
                                <th>Hành động</th>
                            </tr>
                            </thead>
                            <tbody th:each="product : ${products}">
                            <tr>
                                <td>
                                    <div th:if="${product.images != null}" th:each="image : ${product.images}">
                                        <img th:src="@{'/Image/imageUrl/' + ${image.imageUrl}}" alt="Image" class="product-image" width="50"/>
                                    </div>
                                </td>
                                <td th:text="${product.name}"></td>
                                <td th:text="${product.category.categoryName}"></td>
                                <td th:text="${product.brand.brandName}"></td>
                                <td th:text="${product.warehouse.warehouseName}"></td>
                                <td th:text="${product.description}"></td>
                                <td th:text="${product.price}"></td>
                                <td th:text="${product.sale != null ? product.sale : 0}"></td>
                                <td th:text="${product.stockQuantity}"></td>
                                <td th:text="${product.unit}"></td>
                                <td th:text="${product.origin}"></td>
                                <td>
                                    <a class="btn" th:href="@{/Products/EditProduct/{id}(id=${product.productId})}">
                                        <img src="/admin/img/icons/edit.svg" alt="img" />
                                    </a>
                                    <a class="btn" th:href="@{/Products/DeleteProduct/{id}(id=${product.productId})}">
                                        <img src="/admin/img/icons/delete.svg" alt="img" />
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination-wrapper text-center mt-4">
                        <span th:if="${currentPage > 0}" class="pagination-button btn btn-outline-success">
                            <a th:href="@{/Products/ProductList(page=0)}"><i class="bi bi-chevron-double-left"></i></a>
                        </span>

                        <span th:if="${currentPage > 0}" class="pagination-button btn btn-outline-success">
                            <a th:href="@{/Products/ProductList(page=${currentPage - 1})}"><i class="bi bi-chevron-left"></i></a>
                        </span>

                        <span class="pagination-info btn btn-info text-light">
                            Trang <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span>
                        </span>

                        <span th:if="${currentPage < totalPages - 1}" class="pagination-button btn btn-outline-success">
                            <a th:href="@{/Products/ProductList(page=${currentPage + 1})}"><i class="bi bi-chevron-right"></i></a>
                        </span>

                        <span th:if="${currentPage < totalPages - 1}" class="pagination-button btn btn-outline-success">
                            <a th:href="@{/Products/ProductList(page=${totalPages - 1})}"><i class="bi bi-chevron-double-right"></i></a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
